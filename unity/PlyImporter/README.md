# Unity PLY Importer

A simple PLY file importer for Unity with full vertex color support. Designed to work with meshes generated by the splat-to-model pipeline.

## Features

- Imports PLY files directly into Unity
- Full vertex color support (the main reason this exists)
- Supports both ASCII and binary PLY formats
- **Automatic render pipeline detection** - automatically uses the correct shader for Built-in, URP, or HDRP
- Automatic material creation with vertex color shaders
- Drag-and-drop import in Unity Editor
- Shaders for Built-in, URP, and unlit rendering

## Installation

1. Copy the entire `PlyImporter` folder into your Unity project's `Assets` folder:
   ```
   YourUnityProject/
     Assets/
       PlyImporter/
         PlyImporter.cs
         Editor/
           PlyImporterEditor.cs
         Shaders/
           VertexColor.shader
           VertexColorUnlit.shader
           VertexColorURP.shader
         README.md
   ```

2. Unity will automatically compile the scripts and register the PLY importer.

## Usage

### Automatic Import (Recommended)

Simply drag and drop a `.ply` file into your Unity Project window. The importer will:

1. Parse the PLY file
2. Create a mesh with vertices, triangles, normals, and vertex colors
3. Create a material using the vertex color shader
4. Create a prefab ready to use

Click on the imported PLY asset to see import options:
- **Swap YZ**: Toggle to swap Y and Z axes (useful for coordinate system conversion)
- **Scale**: Adjust the scale of the imported mesh
- **Recalculate Normals**: Force Unity to recalculate normals

### Manual Import

Use the menu: `Assets > Import PLY File`

This opens a file browser and creates the mesh, material, and prefab in your Assets folder.

### Runtime Import

You can also import PLY files at runtime:

```csharp
using UnityEngine;

public class RuntimePlyLoader : MonoBehaviour
{
    public string plyFilePath = "path/to/mesh.ply";
    
    void Start()
    {
        // Import the PLY file
        Mesh mesh = PlyImporter.Import(plyFilePath, swapYZ: false, scale: 1f);
        
        if (mesh != null)
        {
            // Create a GameObject to display the mesh
            var go = new GameObject("ImportedMesh");
            var meshFilter = go.AddComponent<MeshFilter>();
            var meshRenderer = go.AddComponent<MeshRenderer>();
            
            meshFilter.mesh = mesh;
            
            // Assign a vertex color material
            var shader = Shader.Find("Custom/VertexColor");
            meshRenderer.material = new Material(shader);
        }
    }
}
```

## Shaders

Three vertex color shaders are included. **The importer automatically detects your render pipeline and uses the correct shader.**

### Custom/VertexColor (Built-in RP)
- For Built-in Render Pipeline
- Includes basic diffuse lighting
- Supports shadows
- Toggle for double-sided rendering

### Custom/VertexColorUnlit
- Simple unlit shader
- Shows vertex colors without any lighting
- Fastest option, good for debugging

### Custom/VertexColorURP
- For Universal Render Pipeline (URP)
- Includes basic lighting and shadows
- Material options:
  - **Cull Mode**: Off (both sides), Front, or Back (default)
  - **Flip Normals**: Toggle to flip normals if mesh appears inside-out

### Automatic Pipeline Detection

When you import a PLY file, the importer checks which render pipeline you're using:

| Render Pipeline | Shader Used |
|----------------|-------------|
| Built-in | Custom/VertexColor |
| URP | Custom/VertexColorURP |
| HDRP | HDRP/Lit (fallback) |

If the custom shader isn't found, it falls back to built-in alternatives.

## Coordinate Systems

Different 3D tools use different coordinate systems:

| Tool | Up Axis | Forward Axis |
|------|---------|--------------|
| Unity | Y | Z |
| Blender | Z | -Y |
| Open3D | Z | Y |

If your model appears rotated incorrectly, try enabling **Swap YZ** in the import settings.

## Troubleshooting

### Model appears pink (missing shader)
- This usually means the shader failed to compile or isn't compatible with your render pipeline
- **For URP projects**: Make sure `VertexColorURP.shader` is in your project
- Try reimporting the PLY file after adding the shaders
- Check the Console for shader compilation errors

### Model appears white
- Make sure you're using one of the vertex color shaders (Custom/VertexColor or Custom/VertexColorURP)
- Standard Unity shaders don't display vertex colors by default
- Check that the PLY file actually contains color data

### Model is very small or large
- Adjust the **Scale** import setting
- Common scales: 0.01 (cm to meters), 100 (meters to cm)

### Model appears inside-out or has dark faces
- The mesh normals may be flipped
- **For URP**: On the material, set **Cull Mode** to `Off` (renders both sides)
- **For URP**: Toggle **Flip Normals** on the material
- Or enable **Recalculate Normals** in import settings
- Or regenerate the mesh with `--flip-normals` flag in the pipeline

### Colors look wrong
- The PLY file may use 0-1 range instead of 0-255 for colors
- The importer auto-detects this, but edge cases may occur

### Large meshes fail to import
- Unity has a 65,535 vertex limit for 16-bit index buffers
- The importer automatically switches to 32-bit indices for larger meshes
- If issues persist, try simplifying the mesh before import

## PLY Format Support

The importer supports:
- ASCII format PLY files
- Binary little-endian PLY files
- Binary big-endian PLY files

Supported vertex properties:
- Position: `x`, `y`, `z`
- Normals: `nx`, `ny`, `nz`
- Colors: `red`/`r`, `green`/`g`, `blue`/`b`, `alpha`/`a`

Supported face formats:
- Triangles (3 vertices)
- Quads (4 vertices, auto-triangulated)
- N-gons (auto-triangulated via fan)

## License

MIT License - Use freely in your projects.
