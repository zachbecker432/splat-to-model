services:
  splat-to-mesh:
    build: .
    image: splat-to-mesh:latest
    volumes:
      - ./data:/data
    environment:
      # ============================================================
      # REQUIRED - Input/Output Files
      # ============================================================
      
      # INPUT_FILE: The Gaussian Splat PLY file to convert (must exist in ./data folder)
      # Supports standard 3DGS exports from Postshot, Luma, Polycam, etc.
      - INPUT_FILE=model.ply
      
      # OUTPUT_FILE: The output mesh filename (will be created in ./data folder)
      # Supported formats: .obj, .ply, .stl, .off, .gltf
      - OUTPUT_FILE=mesh.obj
      
      # ============================================================
      # STAGE 1: Point Cloud Extraction (splat -> point cloud)
      # ============================================================
      
      # OPACITY_THRESHOLD: Minimum opacity (0.0-1.0) for a Gaussian to be included
      # - Lower values (0.1-0.2): Keep more points, including semi-transparent ones (more detail, more noise)
      # - Higher values (0.5-0.7): Keep only solid/opaque points (cleaner mesh, may lose thin features)
      # - Default: 0.3 (balanced)
      - OPACITY_THRESHOLD=0.3
      
      # MAX_SCALE: Maximum Gaussian scale/size to include (filters out large "blobby" Gaussians)
      # - Unset: No scale filtering (keep all sizes)
      # - Small values (0.01-0.05): Only keep small/sharp Gaussians (removes background blobs)
      # - Useful for cleaning up splats with large floaters or sky artifacts
      # - Default: unset (no filtering)
      # - MAX_SCALE=0.05
      
      # ============================================================
      # STAGE 2: Mesh Generation (point cloud -> mesh via Ball Pivoting)
      # ============================================================
      
      # VOXEL_SIZE: Voxel size for point cloud downsampling before meshing
      # - Unset: Auto-calculate based on point cloud density (recommended)
      # - 0: Disable downsampling entirely (use all points - slower, higher detail)
      # - Positive value (e.g., 0.005): Force specific voxel size (larger = fewer points = faster)
      # - Default: auto-calculated
      # - VOXEL_SIZE=0
      
      # TARGET_TRIANGLES: Simplify final mesh to this triangle count
      # - Unset: No simplification (keep all triangles from BPA reconstruction)
      # - Low values (10000-50000): Lightweight mesh for mobile/web
      # - High values (100000+): Detailed mesh for desktop/film
      # - Default: unset (no simplification)
      # - TARGET_TRIANGLES=50000
      
      # OUTLIER_STD_RATIO: Statistical outlier removal sensitivity (std deviation multiplier)
      # - Lower values (1.0-1.5): Aggressive removal (removes more points as outliers)
      # - Higher values (2.5-4.0): Permissive (keeps more points, including potential noise)
      # - Default: 2.0 (balanced)
      - OUTLIER_STD_RATIO=2.0
      
      # THIN_GEOMETRY: Enable thin geometry mode for Ball Pivoting Algorithm
      # - true: Use smaller ball radii to capture thin features (fences, wires, leaves)
      # - false: Standard radii only (faster, but may miss thin structures)
      # - Default: true
      - THIN_GEOMETRY=true
      
      # ============================================================
      # STAGE 3: Mesh Post-Processing
      # ============================================================
      
      # FLIP_NORMALS: Reverse the direction of all mesh normals
      # - true: Flip normals (use if mesh appears inside-out in your viewer)
      # - false: Keep original normal direction
      # - Default: false
      - FLIP_NORMALS=false
      
      # DOUBLE_SIDED: Duplicate all triangles with reversed winding to make mesh visible from both sides
      # - true: Double triangle count, visible from any angle (useful for thin surfaces like leaves)
      # - false: Single-sided mesh (standard, smaller file size)
      # - Default: false
      - DOUBLE_SIDED=false
      
      # SMOOTH_FINAL: Apply Taubin smoothing to reduce mesh roughness
      # - true: Smooth the mesh (reduces sharp edges, can lose detail)
      # - false: Keep raw mesh from BPA reconstruction
      # - Default: false
      - SMOOTH_FINAL=false
      
      # SMOOTH_ITERATIONS: Number of Taubin smoothing passes (only used if SMOOTH_FINAL=true)
      # - Lower values (1-3): Light smoothing, preserves detail
      # - Higher values (10-20): Heavy smoothing, very soft appearance
      # - Default: 5
      # - SMOOTH_ITERATIONS=5
      
      # ============================================================
      # Output Options
      # ============================================================
      
      # KEEP_INTERMEDIATE: Keep the intermediate point cloud PLY file after meshing
      # - true: Save {input}_pointcloud.ply alongside the mesh (useful for debugging)
      # - false: Delete intermediate file after mesh is generated
      # - Default: false
      - KEEP_INTERMEDIATE=false
      
      # VERBOSE: Print detailed progress and statistics during processing
      # - true: Show all processing steps, timings, and statistics
      # - false: Minimal output (errors only)
      # - Default: true
      - VERBOSE=true
